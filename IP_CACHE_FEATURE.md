# IP缓存功能说明

## 功能概述

IP缓存功能可以自动记住成功连接的服务器IP地址，下次连接时可以直接从历史记录中选择，提升用户体验。

## 核心特性

### ✨ 智能缓存
- 连接成功后自动保存IP地址、端口和TLS设置
- 最多保存10条历史连接记录
- 自动去重，相同IP和端口的连接会被更新到最前面

### 🔍 便捷选择
- 提供"历史连接记录"下拉选择框
- 显示连接时间（刚刚/X分钟前/X小时前/X天前）
- TLS状态图标（🔒表示加密，🔓表示无加密）
- 选择历史连接后自动填入所有相关设置

### 🗂️ 历史管理
- 一键清除所有历史记录
- 最近连接的IP地址在应用启动时自动填入

## 使用方法

### 1. 连接服务器
1. 在"连接到服务器"面板中输入IP地址和端口
2. 选择是否使用TLS加密
3. 点击"连接"按钮

### 2. 自动缓存
连接成功后，系统会自动将连接信息保存到缓存中：
- IP地址
- 端口号
- TLS设置
- 连接时间

### 3. 使用历史记录
1. 在"历史连接记录"下拉框中选择之前连接过的服务器
2. 系统会自动填入所有相关设置
3. 点击"连接"按钮即可

### 4. 清除历史记录
点击历史记录下拉框右侧的垃圾桶图标，可以清除所有历史记录。

## 技术实现

### 存储方式
- 使用 `localStorage` 进行本地存储
- 存储键名: `inputleap-connection-history`
- 数据格式: JSON数组

### 数据结构
```json
[
  {
    "host": "192.168.1.100",
    "port": 24800,
    "useTLS": true,
    "lastConnected": "2025-12-05T16:18:36.123Z"
  }
]
```

### 核心函数
- `saveConnectionToCache()`: 保存连接到缓存
- `loadConnectionHistory()`: 加载历史记录
- `updateHistoryDropdown()`: 更新下拉框显示
- `selectFromHistory()`: 从历史记录中选择
- `clearHistory()`: 清除历史记录

## 界面展示

### 历史记录下拉框
- 位置: 服务器地址输入框下方
- 格式: "🔒 192.168.1.100:24800 (2分钟前)"
- 默认选项: "选择历史连接..."

### 清除按钮
- 位置: 下拉框右侧
- 图标: 🗑️ (垃圾桶)
- 显示条件: 存在历史记录时显示

## 安全性

- 所有数据仅存储在用户本地设备
- 不会上传或共享任何连接信息
- 用户可以随时清除历史记录

## 测试验证

运行测试脚本验证功能：
```bash
node test/ip-cache-test.js
```

测试包括：
1. 保存第一次连接
2. 保存第二次连接
3. 重复连接去重
4. 加载历史记录
5. 缓存内容验证

## 更新日志

### 2025-12-06
- ✨ 新增IP连接历史缓存功能
- ✨ 新增历史记录下拉选择框
- ✨ 新增一键清除历史记录功能
- ✨ 新增自动填入最近连接IP
- 🔧 优化连接成功后的缓存保存逻辑